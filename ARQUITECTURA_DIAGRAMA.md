# ğŸ—ï¸ Diagrama de Arquitectura AWS - Twitter Clone

## Arquitectura Completa Desplegada

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                        â”‚
â”‚                         ğŸ‘¥ USUARIOS FINALES                            â”‚
â”‚                      (Navegadores Web, MÃ³viles)                        â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTPS
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â˜ï¸ AWS CLOUDFRONT (CDN)                            â”‚
â”‚                                                                        â”‚
â”‚  â€¢ DistribuciÃ³n Global de Contenido                                   â”‚
â”‚  â€¢ SSL/TLS Certificado                                                â”‚
â”‚  â€¢ CachÃ© en Edge Locations                                            â”‚
â”‚  â€¢ Custom Error Pages (403/404 â†’ index.html)                          â”‚
â”‚                                                                        â”‚
â”‚  URL: https://d1234abcd5678.cloudfront.net                            â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                             â”‚
                â”‚                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              â”‚              â”‚                      â”‚
        â”‚  ğŸ“¦ S3       â”‚              â”‚  ğŸ–¥ï¸ EXPRESS SERVER   â”‚
        â”‚  BUCKET      â”‚              â”‚     (OAuth Proxy)    â”‚
        â”‚              â”‚              â”‚                      â”‚
        â”‚  Static      â”‚              â”‚  â€¢ Session Mgmt      â”‚
        â”‚  Website     â”‚              â”‚  â€¢ Cognito OAuth     â”‚
        â”‚  Hosting     â”‚              â”‚  â€¢ API Proxy         â”‚
        â”‚              â”‚              â”‚                      â”‚
        â”‚  Files:      â”‚              â”‚  Deploy:             â”‚
        â”‚  â€¢ index.htmlâ”‚              â”‚  â€¢ Lambda, o         â”‚
        â”‚  â€¢ assets/   â”‚              â”‚  â€¢ EC2 t2.micro      â”‚
        â”‚  â€¢ *.js      â”‚              â”‚                      â”‚
        â”‚  â€¢ *.css     â”‚              â”‚  Port: 3000          â”‚
        â”‚              â”‚              â”‚                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                                                 â”‚ REST API
                                                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              ğŸŒ AWS API GATEWAY (REST API)                 â”‚
        â”‚                                                            â”‚
        â”‚  â€¢ Regional Endpoint                                       â”‚
        â”‚  â€¢ CORS Enabled                                            â”‚
        â”‚  â€¢ Lambda Proxy Integration                                â”‚
        â”‚  â€¢ Stage: prod                                             â”‚
        â”‚                                                            â”‚
        â”‚  URL: https://abc123xyz.execute-api.us-east-1.amazonaws... â”‚
        â”‚                                                            â”‚
        â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                      â”‚                      â”‚
           â”‚                      â”‚                      â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
    â”‚            â”‚        â”‚            â”‚        â”‚            â”‚
    â”‚  /user/*   â”‚        â”‚  /post/*   â”‚        â”‚ /stream/*  â”‚
    â”‚            â”‚        â”‚            â”‚        â”‚            â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
           â”‚                      â”‚                      â”‚
           â”‚                      â”‚                      â”‚
           â–¼                      â–¼                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚       â”‚             â”‚       â”‚             â”‚
    â”‚  âš¡ LAMBDA  â”‚       â”‚  âš¡ LAMBDA  â”‚       â”‚  âš¡ LAMBDA  â”‚
    â”‚             â”‚       â”‚             â”‚       â”‚             â”‚
    â”‚   USER      â”‚       â”‚    POST     â”‚       â”‚   STREAM    â”‚
    â”‚  SERVICE    â”‚       â”‚   SERVICE   â”‚       â”‚   SERVICE   â”‚
    â”‚             â”‚       â”‚             â”‚       â”‚             â”‚
    â”‚ Java 17     â”‚       â”‚ Java 17     â”‚       â”‚ Java 17     â”‚
    â”‚ Spring Boot â”‚       â”‚ Spring Boot â”‚       â”‚ Spring Boot â”‚
    â”‚   1024 MB   â”‚       â”‚   1024 MB   â”‚       â”‚   1024 MB   â”‚
    â”‚   30s TO    â”‚       â”‚   30s TO    â”‚       â”‚   30s TO    â”‚
    â”‚             â”‚       â”‚             â”‚       â”‚             â”‚
    â”‚ Handler:    â”‚       â”‚ Handler:    â”‚       â”‚ Handler:    â”‚
    â”‚ StreamLambdaâ”‚       â”‚ StreamLambdaâ”‚       â”‚ StreamLambdaâ”‚
    â”‚ Handler     â”‚       â”‚ Handler     â”‚       â”‚ Handler     â”‚
    â”‚             â”‚       â”‚             â”‚       â”‚             â”‚
    â”‚ Endpoints:  â”‚       â”‚ Endpoints:  â”‚       â”‚ Endpoints:  â”‚
    â”‚ â€¢ GET users â”‚       â”‚ â€¢ POST postsâ”‚       â”‚ â€¢ GET       â”‚
    â”‚ â€¢ PUT users â”‚       â”‚ â€¢ GET posts â”‚       â”‚   timeline  â”‚
    â”‚ â€¢ POST      â”‚       â”‚ â€¢ POST like â”‚       â”‚ â€¢ GET user  â”‚
    â”‚   follow    â”‚       â”‚ â€¢ POST      â”‚       â”‚   timeline  â”‚
    â”‚             â”‚       â”‚   comment   â”‚       â”‚             â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚                     â”‚                      â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                                 â”‚
                â–¼                                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                      â”‚        â”‚                      â”‚
    â”‚  ğŸƒ MONGODB ATLAS    â”‚        â”‚  ğŸ” AWS COGNITO      â”‚
    â”‚                      â”‚        â”‚                      â”‚
    â”‚  â€¢ Cluster M0        â”‚        â”‚  â€¢ User Pool         â”‚
    â”‚  â€¢ Database: twitter â”‚        â”‚  â€¢ OAuth 2.0         â”‚
    â”‚  â€¢ Collections:      â”‚        â”‚  â€¢ JWT Tokens        â”‚
    â”‚    - users           â”‚        â”‚  â€¢ Hosted UI         â”‚
    â”‚    - posts           â”‚        â”‚                      â”‚
    â”‚    - comments        â”‚        â”‚  Pool ID:            â”‚
    â”‚                      â”‚        â”‚  us-east-1_3UE2M9... â”‚
    â”‚  URI:                â”‚        â”‚                      â”‚
    â”‚  mongodb+srv://...   â”‚        â”‚  Issuer URI:         â”‚
    â”‚                      â”‚        â”‚  https://cognito-... â”‚
    â”‚                      â”‚        â”‚                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                      â”‚
    â”‚  ğŸ“Š CLOUDWATCH       â”‚
    â”‚                      â”‚
    â”‚  â€¢ Lambda Logs:      â”‚
    â”‚    - /aws/lambda/    â”‚
    â”‚      twitter-user    â”‚
    â”‚    - /aws/lambda/    â”‚
    â”‚      twitter-post    â”‚
    â”‚    - /aws/lambda/    â”‚
    â”‚      twitter-stream  â”‚
    â”‚                      â”‚
    â”‚  â€¢ Metrics:          â”‚
    â”‚    - Invocations     â”‚
    â”‚    - Duration        â”‚
    â”‚    - Errors          â”‚
    â”‚    - Throttles       â”‚
    â”‚                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo de AutenticaciÃ³n (OAuth 2.0 con Cognito)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         â”‚  1. Click "Login"                                  â”‚          â”‚
â”‚  USER   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ FRONTEND â”‚
â”‚         â”‚                                                    â”‚ (React)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                                                    â”‚
                                                                    â”‚ 2. GET /api/auth/login
                                                                    â–¼
                                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                               â”‚ EXPRESS â”‚
                                                               â”‚ SERVER  â”‚
                                                               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                                                    â”‚
                                                                    â”‚ 3. Redirect to Cognito
                                                                    â”‚    with state & nonce
                                                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                        AWS COGNITO                                 â”‚
    â”‚                                                                    â”‚
    â”‚  4. User Login Form                                                â”‚
    â”‚     â€¢ Email                                                        â”‚
    â”‚     â€¢ Password                                                     â”‚
    â”‚                                                                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ 5. Authentication Success
                         â”‚    Authorization Code
                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ EXPRESS â”‚
                    â”‚ SERVER  â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ 6. Exchange code for tokens
                         â”‚    â€¢ ID Token (JWT)
                         â”‚    â€¢ Access Token
                         â”‚    â€¢ Refresh Token
                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ SESSION â”‚
                    â”‚ STORAGE â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ 7. Redirect to app
                         â”‚    Set session cookie
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         â”‚         â”‚ FRONTENDâ”‚
â”‚  USER   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ (React) â”‚
â”‚         â”‚  8. Showâ”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  logged â”‚         â”‚
             in UI  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo de Request API (Crear Post)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    
â”‚         â”‚  1. Create Post                                    
â”‚  USER   â”‚     "Hello World!"                                 
â”‚         â”‚                                                     
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                     
     â”‚                                                          
     â”‚ 2. POST /api/posts                                      
     â–¼                                                          
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     
â”‚ REACT   â”‚                                                     
â”‚ FRONTENDâ”‚                                                     
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                     
     â”‚                                                          
     â”‚ 3. GET /api/auth/status                                 
     â”‚    (get Access Token)                                   
     â–¼                                                          
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     
â”‚ EXPRESS â”‚                                                     
â”‚ SERVER  â”‚                                                     
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                     
     â”‚                                                          
     â”‚ 4. Return Access Token (JWT)                            
     â–¼                                                          
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     
â”‚ REACT   â”‚  5. POST /post/api/posts                          
â”‚ FRONTENDâ”œâ”€â”€â”€â–º Authorization: Bearer <JWT>                    
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     Body: { content: "Hello World!", ... }         
                                                                
                    â”‚                                           
                    â–¼                                           
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    
            â”‚ API GATEWAY  â”‚                                    
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                    
                   â”‚                                            
                   â”‚ 6. Invoke Lambda                           
                   â”‚    with API Gateway Proxy event            
                   â–¼                                            
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    
            â”‚ POST SERVICE â”‚                                    
            â”‚   LAMBDA     â”‚                                    
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                    
                   â”‚                                            
                   â”‚ 7. Spring Security validates JWT           
                   â”‚    (JwtDecoder with Cognito JWK)           
                   â”‚                                            
                   â”‚ 8. Extract user from JWT (sub claim)       
                   â”‚                                            
                   â”‚ 9. Call User Service to get user data      
                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       
                   â”‚                    â”‚                       
                   â”‚                    â–¼                       
                   â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                
                   â”‚            â”‚ USER SERVICE â”‚                
                   â”‚            â”‚   LAMBDA     â”‚                
                   â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                
                   â”‚                   â”‚                        
                   â”‚                   â”‚ 10. Query MongoDB      
                   â”‚                   â–¼                        
                   â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                
                   â”‚            â”‚   MONGODB    â”‚                
                   â”‚            â”‚    ATLAS     â”‚                
                   â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                
                   â”‚                   â”‚                        
                   â”‚    11. Return     â”‚                        
                   â”‚â—„â”€â”€â”€â”€â”€â”€user dataâ”€â”€â”€â”˜                        
                   â”‚                                            
                   â”‚ 12. Create Post object                     
                   â”‚     with user reference                    
                   â”‚                                            
                   â”‚ 13. Save to MongoDB                        
                   â–¼                                            
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    
            â”‚   MONGODB    â”‚                                    
            â”‚    ATLAS     â”‚                                    
            â”‚              â”‚                                    
            â”‚  posts       â”‚                                    
            â”‚  collection  â”‚                                    
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                    
                   â”‚                                            
                   â”‚ 14. Return saved post                      
                   â–¼                                            
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    
            â”‚ POST SERVICE â”‚                                    
            â”‚   LAMBDA     â”‚                                    
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                    
                   â”‚                                            
                   â”‚ 15. Return PostResponseDTO                 
                   â–¼                                            
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    
            â”‚ API GATEWAY  â”‚                                    
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                    
                   â”‚                                            
                   â”‚ 16. HTTP 201 Created                       
                   â”‚     + Post JSON                            
                   â–¼                                            
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     
â”‚ REACT   â”‚  17. Update UI                                     
â”‚ FRONTENDâ”‚      Add post to timeline                          
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                     
```

---

## Componentes y Responsabilidades

### Frontend Layer
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CLOUDFRONT + S3                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Servir archivos estÃ¡ticos (React)   â”‚
â”‚ â€¢ SSL/TLS termination                  â”‚
â”‚ â€¢ CachÃ© de contenido                   â”‚
â”‚ â€¢ DistribuciÃ³n global                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Application Layer
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         EXPRESS SERVER                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ OAuth 2.0 flow con Cognito          â”‚
â”‚ â€¢ GestiÃ³n de sesiones                  â”‚
â”‚ â€¢ Proxy a microservicios               â”‚
â”‚ â€¢ CORS handling                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API Layer
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         API GATEWAY                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Routing a Lambdas                    â”‚
â”‚ â€¢ Request/Response transformation      â”‚
â”‚ â€¢ Throttling & Rate limiting           â”‚
â”‚ â€¢ CORS configuration                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Business Logic Layer
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER SERVICE â”‚  â”‚ POST SERVICE â”‚  â”‚STREAM SERVICEâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ User CRUD  â”‚  â”‚ â€¢ Post CRUD  â”‚  â”‚ â€¢ Timeline   â”‚
â”‚ â€¢ Profiles   â”‚  â”‚ â€¢ Likes      â”‚  â”‚ â€¢ Aggregationâ”‚
â”‚ â€¢ Follow/    â”‚  â”‚ â€¢ Comments   â”‚  â”‚ â€¢ Filtering  â”‚
â”‚   Unfollow   â”‚  â”‚              â”‚  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Layer
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         MONGODB ATLAS                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Collections:                           â”‚
â”‚ â€¢ users                                â”‚
â”‚   - cognitoId, username, email,        â”‚
â”‚     followers, following               â”‚
â”‚                                        â”‚
â”‚ â€¢ posts                                â”‚
â”‚   - userId, content, likes,            â”‚
â”‚     comments, createdAt                â”‚
â”‚                                        â”‚
â”‚ â€¢ No joins - Denormalized              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Security Layer
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         AWS COGNITO                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ User Pool                            â”‚
â”‚ â€¢ OAuth 2.0 / OpenID Connect           â”‚
â”‚ â€¢ JWT token generation                 â”‚
â”‚ â€¢ Hosted UI                            â”‚
â”‚ â€¢ MFA (Multi-Factor Auth)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Monitoring Layer
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CLOUDWATCH                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Lambda execution logs                â”‚
â”‚ â€¢ API Gateway access logs              â”‚
â”‚ â€¢ Metrics (invocations, duration)      â”‚
â”‚ â€¢ Alarms & notifications               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Seguridad y Flujo de Tokens

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   COGNITO    â”‚
                    â”‚  USER POOL   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Issues JWT
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  JWT TOKEN   â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ Header:      â”‚
                    â”‚  alg: RS256  â”‚
                    â”‚              â”‚
                    â”‚ Payload:     â”‚
                    â”‚  sub: userid â”‚
                    â”‚  email: ...  â”‚
                    â”‚  exp: ...    â”‚
                    â”‚              â”‚
                    â”‚ Signature:   â”‚
                    â”‚  signed with â”‚
                    â”‚  Cognito key â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Sent in Authorization header
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                     â”‚
        â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER SERVICE  â”‚                    â”‚ POST SERVICE  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Spring        â”‚                    â”‚ Spring        â”‚
â”‚ Security:     â”‚                    â”‚ Security:     â”‚
â”‚               â”‚                    â”‚               â”‚
â”‚ 1. Extract    â”‚                    â”‚ 1. Extract    â”‚
â”‚    JWT from   â”‚                    â”‚    JWT from   â”‚
â”‚    header     â”‚                    â”‚    header     â”‚
â”‚               â”‚                    â”‚               â”‚
â”‚ 2. Validate   â”‚                    â”‚ 2. Validate   â”‚
â”‚    signature  â”‚                    â”‚    signature  â”‚
â”‚    with       â”‚                    â”‚    with       â”‚
â”‚    Cognito    â”‚                    â”‚    Cognito    â”‚
â”‚    JWK        â”‚                    â”‚    JWK        â”‚
â”‚               â”‚                    â”‚               â”‚
â”‚ 3. Check      â”‚                    â”‚ 3. Check      â”‚
â”‚    expiration â”‚                    â”‚    expiration â”‚
â”‚               â”‚                    â”‚               â”‚
â”‚ 4. Extract    â”‚                    â”‚ 4. Extract    â”‚
â”‚    user from  â”‚                    â”‚    user from  â”‚
â”‚    claims     â”‚                    â”‚    claims     â”‚
â”‚               â”‚                    â”‚               â”‚
â”‚ 5. Authorize  â”‚                    â”‚ 5. Authorize  â”‚
â”‚    request    â”‚                    â”‚    request    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Escalabilidad

```
ğŸ“ˆ Carga Baja (0-100 requests/min)
â”œâ”€ Lambda: 1-2 instancias concurrentes
â”œâ”€ Costo: ~$0/mes (Free Tier)
â””â”€ Latencia: 200-500ms (con cold start)

ğŸ“ˆ Carga Media (100-1000 requests/min)
â”œâ”€ Lambda: 5-10 instancias concurrentes
â”œâ”€ Costo: ~$5-10/mes
â””â”€ Latencia: 100-200ms (warm instances)

ğŸ“ˆ Carga Alta (1000+ requests/min)
â”œâ”€ Lambda: 50+ instancias concurrentes
â”œâ”€ Considerar: Provisioned Concurrency
â”œâ”€ Considerar: ElastiCache (Redis)
â”œâ”€ Costo: $50-100/mes
â””â”€ Latencia: <100ms

âš¡ Auto-scaling automÃ¡tico en todos los niveles
```

---

## Resiliencia y Alta Disponibilidad

```
CLOUDFRONT
â”œâ”€ Edge locations globally (200+)
â”œâ”€ Automatic failover
â””â”€ DDoS protection

API GATEWAY
â”œâ”€ Multi-AZ deployment
â”œâ”€ Automatic scaling
â””â”€ 99.95% SLA

LAMBDA
â”œâ”€ Multi-AZ by default
â”œâ”€ Automatic retries
â”œâ”€ Dead Letter Queue (DLQ) opcional
â””â”€ 99.95% SLA

MONGODB ATLAS
â”œâ”€ Replica Set (3 nodes)
â”œâ”€ Automatic failover
â”œâ”€ Point-in-time recovery
â””â”€ 99.995% SLA (M10+)

COGNITO
â”œâ”€ Multi-AZ
â”œâ”€ Automatic scaling
â””â”€ 99.9% SLA
```

---

Este diagrama muestra la arquitectura completa desplegada en AWS.
